 docker-compose.yml
 
 depends_on:
      - db
    environment:
      MONGODB_URI: 'mongodb://db:27017/myappdb'
    links:
      - db
  db:
    image: mongo:latest
    ports:
      - '27017:27017'
    volumes:
      - ./data:/data/db


      chat gpt  useRoutes.ts

      import type { NextApiRequest, NextApiResponse } from 'next';
import prisma from '../../lib/prisma';
import { createUser, getUsers, getUserById, updateUserById, deleteUserById } from '../../controllers/usersController';

export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  const { method, query } = req;

  switch (method) {
    case 'GET':
      if (query.id) {
        const user = await getUserById(query.id.toString());
        res.status(200).json(user);
      } else {
        const users = await getUsers();
        res.status(200).json(users);
      }
      break;

    case 'POST':
      const { name, email, password } = req.body;
      const newUser = await createUser(name, email, password);
      res.status(201).json(newUser);
      break;

    case 'PUT':
      const { id } = query;
      const { name: newName, email: newEmail, password: newPassword } = req.body;
      const updatedUser = await updateUserById(id.toString(), newName, newEmail, newPassword);
      res.status(200).json(updatedUser);
      break;

    case 'DELETE':
      const userId = query.id.toString();
      await deleteUserById(userId);
      res.status(204).send();
      break;

    default:
      res.setHeader('Allow', ['GET', 'POST', 'PUT', 'DELETE']);
      res.status(405).end(`Method ${method} Not Allowed`);
  }
}

chat 2

import { NextApiRequest, NextApiResponse } from 'next';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  switch (req.method) {
    case 'GET':
      return handleGet(req, res);
    case 'POST':
      return handlePost(req, res);
    case 'PUT':
      return handlePut(req, res);
    case 'DELETE':
      return handleDelete(req, res);
    default:
      return res.status(405).json({ message: 'Method not allowed' });
  }
}

async function handleGet(req: NextApiRequest, res: NextApiResponse) {
  const users = await prisma.user.findMany();
  res.status(200).json(users);
}

async function handlePost(req: NextApiRequest, res: NextApiResponse) {
  const { name, email, password } = req.body;
  const newUser = await prisma.user.create({ data: { name, email, password } });
  res.status(201).json(newUser);
}

async function handlePut(req: NextApiRequest, res: NextApiResponse) {
  const { id } = req.query;
  const { name, email, password } = req.body;
 
api/users

import { NextApiRequest, NextApiResponse } from 'next';
import prisma from '../../lib/prisma';

export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  if (req.method === 'GET') {
    const users = await prisma.user.findMany();
    res.status(200).json(users);
  } else if (req.method === 'POST') {
    const { name, email, password } = req.body;
    const newUser = await prisma.user.create({
      data: {
        name,
        email,
        password,
      },
    });
    res.status(201).json(newUser);
  } else if (req.method === 'PUT') {
    const { id } = req.query;
    const { name, email, password } = req.body;
    const updatedUser = await prisma.user.update({
      where: { id: Number(id) },
      data: {
        name,
        email,
        password,
      },
    });
    res.status(200).json(updatedUser);
  } else if (req.method === 'DELETE') {
    const { id } = req.query;
    await prisma.user.delete({ where: { id: Number(id) } });
    res.status(204).send();
  } else {
    res.status(405).send();
  }
}


promts

if user has name, email, phone rewrite in the format below
const userRouter = createTRPCRouter({
  getById: publicProcedure.input(z.string()).query(({ ctx, input }) => {
    return ctx.prisma.user.findFirst({
      where: {
        id: input,
      },
    });
  }),
});
use ctx, createTRPCRouter, publicProcedure and nextjs 13
how do i get the data of all users in DB from client side nextjs component
use this format 
const userQuery = api.users.getById.useQuery(query.id);

what of getting all users in the database use ctx, createTRPCRouter, publicProcedure and nextjs 13

use nextjs 13 default useQuery do NOT import useQuery from react-query

this works for server components, what about client Next js 13 components

const isAdmin = async (req, res, next) => {
  // Check if user is authenticated and authorized as an admin
  const user = req.user; // Assuming user object is stored in the request object
  
  // Query the database to check if the user exists in the `admins` table
  const isAdmin = await db.checkIfUserIsAdmin(user.id);
  
  if (!isAdmin) {
    // User is not authorized, send an error response
    return res.status(401).json({ message: 'Unauthorized' });
  }
  
  // User is authorized, continue to the next middleware
  next();
}

// pages/admin/dashboard.js
import { withMiddleware } from '../../middleware';

const Dashboard = () => {
  // Render admin dashboard here
}

export default withMiddleware(Dashboard, isAdmin);

Running seed command `ts-node ./prisma/seed.ts` ...
Start seeding ...
Created user with id: 641ca7d8be8caf6d48376e4c

Created stream with id: 641ca7dbbe8caf6d48376e4d
Created stream with id: 641ca7dcbe8caf6d48376e4e
Created stream with id: 641ca7debe8caf6d48376e4f
Created stream with id: 641ca7dfbe8caf6d48376e50
Created stream with id: 641ca7e0be8caf6d48376e51
Created stream with id: 641ca7e1be8caf6d48376e52
Created stream with id: 641ca7e3be8caf6d48376e53
Created stream with id: 641ca7e4be8caf6d48376e54
Created stream with id: 641ca7e5be8caf6d48376e55
Created stream with id: 641ca7e7be8caf6d48376e56

Created admin with id: 641ca7e8be8caf6d48376e57
Created admin with id: 641ca7e9be8caf6d48376e58
Created admin with id: 641ca7eabe8caf6d48376e59
Seeding finished.

Created student with id: 641dd16d2eece6ce9587cb0c
Created student with id: 641dd16f2eece6ce9587cb0d
Created student with id: 641dd1712eece6ce9587cb0e
Created student with id: 641dd5d8590da608c00b4e69
Created student with id: 641dd5da590da608c00b4e6a
Created student with id: 641dd5db590da608c00b4e6b
Created student with id: 641dd5dd590da608c00b4e6c
Created student with id: 641dd5df590da608c00b4e6d
Created student with id: 641dd5e0590da608c00b4e6e
Created student with id: 641dd5e2590da608c00b4e6f
Created student with id: 641dd5e4590da608c00b4e70
Created student with id: 641dd5e5590da608c00b4e71
Created student with id: 641dd5e7590da608c00b4e72
Created student with id: 641dd5e9590da608c00b4e73
Created student with id: 641dd5eb590da608c00b4e74
Created student with id: 641dd5ec590da608c00b4e75
Created student with id: 641dd5ee590da608c00b4e76
Created student with id: 641dd5f0590da608c00b4e77

Created teacher with id: 641dd5f1590da608c00b4e78
Created teacher with id: 641dd5f2590da608c00b4e79
Created teacher with id: 641dd5f5590da608c00b4e7b
Created teacher with id: 641dd5f6590da608c00b4e7c
Created teacher with id: 641dd5f7590da608c00b4e7d
Created teacher with id: 641dd5fa590da608c00b4e7f

